WITH annual_delays AS (SELECT Year_,count(*) AS num_delays from ontime WHERE DepDelay>10 GROUP BY Year_), annual_flights AS (select Year_,count(*) AS num_flights FROM ontime GROUP BY Year_) SELECT annual_delays.Year_, num_delays/num_flights FROM annual_delays JOIN annual_flights ON (annual_delays.Year_=annual_flights.Year_);
